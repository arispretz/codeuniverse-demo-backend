<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: app.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: app.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @fileoverview Express application setup with routes, middleware, monitoring, and error handling.
 * Configures session management, security policies, API routes, and global error handling.
 * @module app
 */

import express from 'express';
import session from 'express-session';
import dotenv from 'dotenv';
import morgan from 'morgan';

import { checkRole } from './middleware/checkRole.js';
import { auth } from './middleware/authMiddleware.js';
import { validateOrigin } from './middleware/validateOrigin.js';
import { smartOriginValidator } from './middleware/smartOriginValidator.js';
import { codeRouter } from './routes/codeRoutes.js';

import { lintRouter } from './routes/lintRoutes.js';
import { assistantRouter } from './routes/assistantRoutes.js';
import { projectFilesRouter } from './routes/projectFilesRoutes.js';
import { taskRouter } from './routes/taskRoutes.js';
import { projectRouter } from './routes/projectRoutes.js';

import { userRouter } from './routes/userRoutes.js';
import { roleRouter } from './routes/roleRoutes.js';
import { userProfileRouter } from './routes/userProfileRoutes.js';
import { avatarRouter } from './routes/avatarRoutes.js';
import { securityMiddleware } from './security.js';

import { globalErrorHandler } from './middleware/errorHandlers.js';
import { registerRouter } from './routes/registerRoutes.js';

dotenv.config();

const app = express();

/**
 * Session middleware configuration.
 * Requires SESSION_SECRET to be defined in environment variables.
 */
if (!process.env.SESSION_SECRET) {
  throw new Error("âŒ SESSION_SECRET environment variable is not defined. Please set it in your .env file.");
}

app.use(session({
  secret: process.env.SESSION_SECRET,
  resave: false,
  saveUninitialized: false,
  cookie: {
    secure: process.env.NODE_ENV === 'production',
    httpOnly: true,
    sameSite: process.env.NODE_ENV === 'production' ? 'none' : 'lax',
    maxAge: 1000 * 60 * 60 * 24 // 1 day
  }
}));

/**
 * Security middleware (CORS, CSP, etc.)
 */
try {
  securityMiddleware(app);
} catch (err) {
  console.error('ðŸ”¥ Error in securityMiddleware:', err);
}

/**
 * Core middleware
 */
app.use(express.urlencoded({ extended: true }));
app.use(express.json());
app.use(morgan('dev'));

/**
 * Origin validation middleware
 */
app.use(smartOriginValidator);

/**
 * Public routes
 */
app.get('/', (req, res) => {
  res.send('Welcome to the secure and monitored platform.');
});

app.get('/api', (req, res) => {
  res.json({ message: 'pong from Express backend ðŸš€' });
});

app.get('/health', (_, res) => res.json({ status: 'ok' }));

/**
 * Protected route example
 */
app.get('/admin-only', validateOrigin, auth, checkRole(['admin']), (req, res, next) => {
  try {
    res.json({ message: `Hi ${req.user.username}, you have admin access ðŸ”‘` });
  } catch (err) {
    next(err);
  }
});

/**
 * Global authentication middleware for all /api routes
 */
app.use('/api', auth);

/**
 * API routes
 */
app.use('/api', registerRouter); 
app.use('/api', userProfileRouter);
app.use('/api/code', codeRouter);
app.use('/api', lintRouter);
app.use('/api/assistant', assistantRouter);
app.use('/api/project-files', projectFilesRouter);
app.use('/api', taskRouter);
app.use('/api', projectRouter);
app.use('/api/users', userRouter);
app.use('/api', roleRouter);
app.use('/api/avatars', avatarRouter);

/**
 * Catch-all for unmatched /api routes
 */
app.use("/api", (req, res) => {
  res.status(404).json({ error: "Route /api not found" });
});

/**
 * Global catch-all for unmatched routes
 */
app.use((req, res) => {
  res.status(404).json({ error: 'Route not found' });
});

/**
 * Final global error handler
 */
app.use(globalErrorHandler);

export { app };
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="-__tests___app.module_test.html">__tests__/app.test</a></li><li><a href="babel.module_config.html">babel.config</a></li><li><a href="eslint.module_config.html">eslint.config</a></li><li><a href="jest.module_config.html">jest.config</a></li><li><a href="jest.module_setup.html">jest.setup</a></li><li><a href="module-DB_db.html">DB/db</a></li><li><a href="module-__mocks___firebase-admin.html">__mocks__/firebase-admin</a></li><li><a href="module-app.html">app</a></li><li><a href="module-authMiddlewareMock.html">authMiddlewareMock</a></li><li><a href="module-checkRoleMock.html">checkRoleMock</a></li><li><a href="module-config_envConfig.html">config/envConfig</a></li><li><a href="module-config_firebase.html">config/firebase</a></li><li><a href="module-controllers_assistantController.html">controllers/assistantController</a></li><li><a href="module-controllers_autocompleteController.html">controllers/autocompleteController</a></li><li><a href="module-controllers_avatarController.html">controllers/avatarController</a></li><li><a href="module-controllers_codeController.html">controllers/codeController</a></li><li><a href="module-controllers_generateController.html">controllers/generateController</a></li><li><a href="module-controllers_lintController.html">controllers/lintController</a></li><li><a href="module-controllers_projectController.html">controllers/projectController</a></li><li><a href="module-controllers_projectFilesController.html">controllers/projectFilesController</a></li><li><a href="module-controllers_registerController.html">controllers/registerController</a></li><li><a href="module-controllers_taskController.html">controllers/taskController</a></li><li><a href="module-controllers_user_syncUser.html">controllers/user/syncUser</a></li><li><a href="module-controllers_user_syncUserToMongo.html">controllers/user/syncUserToMongo</a></li><li><a href="module-controllers_user_updateUserRole.html">controllers/user/updateUserRole</a></li><li><a href="module-controllers_userController.html">controllers/userController</a></li><li><a href="module-controllers_userProfileController.html">controllers/userProfileController</a></li><li><a href="module-lint_lintRunner.html">lint/lintRunner</a></li><li><a href="module-middleware_authMiddleware.html">middleware/authMiddleware</a></li><li><a href="module-middleware_checkRole.html">middleware/checkRole</a></li><li><a href="module-middleware_errorHandlers.html">middleware/errorHandlers</a></li><li><a href="module-middleware_smartOriginValidator.html">middleware/smartOriginValidator</a></li><li><a href="module-middleware_validateOrigin.html">middleware/validateOrigin</a></li><li><a href="module-models_KanbanList.html">models/KanbanList</a></li><li><a href="module-models_LocalList.html">models/LocalList</a></li><li><a href="module-models_Project.html">models/Project</a></li><li><a href="module-models_ProjectFile.html">models/ProjectFile</a></li><li><a href="module-models_Session.html">models/Session</a></li><li><a href="module-models_Task.html">models/Task</a></li><li><a href="module-models_User.html">models/User</a></li><li><a href="module-models_UserProfile.html">models/UserProfile</a></li><li><a href="module-routes_assistantRoutes.html">routes/assistantRoutes</a></li><li><a href="module-routes_autocompleteRoutes.html">routes/autocompleteRoutes</a></li><li><a href="module-routes_avatarRoutes.html">routes/avatarRoutes</a></li><li><a href="module-routes_codeRoutes.html">routes/codeRoutes</a></li><li><a href="module-routes_generateRoutes.html">routes/generateRoutes</a></li><li><a href="module-routes_lintRoutes.html">routes/lintRoutes</a></li><li><a href="module-routes_projectFilesRoutes.html">routes/projectFilesRoutes</a></li><li><a href="module-routes_projectRoutes.html">routes/projectRoutes</a></li><li><a href="module-routes_registerRoutes.html">routes/registerRoutes</a></li><li><a href="module-routes_roleRoutes.html">routes/roleRoutes</a></li><li><a href="module-routes_taskRoutes.html">routes/taskRoutes</a></li><li><a href="module-routes_userProfileRoutes.html">routes/userProfileRoutes</a></li><li><a href="module-routes_userRoutes.html">routes/userRoutes</a></li><li><a href="module-schemas_kanbanListSchema.html">schemas/kanbanListSchema</a></li><li><a href="module-schemas_localListSchema.html">schemas/localListSchema</a></li><li><a href="module-schemas_projectFileSchema.html">schemas/projectFileSchema</a></li><li><a href="module-schemas_projectSchema.html">schemas/projectSchema</a></li><li><a href="module-schemas_sessionSchema.html">schemas/sessionSchema</a></li><li><a href="module-schemas_taskSchema.html">schemas/taskSchema</a></li><li><a href="module-schemas_userProfileSchema.html">schemas/userProfileSchema</a></li><li><a href="module-schemas_userSchema.html">schemas/userSchema</a></li><li><a href="module-security.html">security</a></li><li><a href="module-server.html">server</a></li><li><a href="module-services_assistantService.html">services/assistantService</a></li><li><a href="module-services_fastapiModelRunner.html">services/fastapiModelRunner</a></li><li><a href="module-setupTerminal.html">setupTerminal</a></li><li><a href="module-smartOriginValidatorMock.html">smartOriginValidatorMock</a></li><li><a href="module-utils_buildTree.html">utils/buildTree</a></li><li><a href="module-utils_roleUtils.html">utils/roleUtils</a></li><li><a href="module-utils_utils.html">utils/utils</a></li><li><a href="module-validateOriginMock.html">validateOriginMock</a></li></ul><h3>Global</h3><ul><li><a href="global.html#updateUserRole">updateUserRole</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Fri Feb 13 2026 23:55:49 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
